#pragma once
#include <array>
#include <cmath>

class AmbiDecode2D
{
public:
	AmbiDecode2D()
		: output(0.0) { }

	inline double play(const std::array<double, 7> & pDecodeIn, double pSpeakerAz)
	{
		size_t order = 3;

		output = 0.5 * pDecodeIn[0];
		output += std::cos(1 * pSpeakerAz) * weight2D[order - 1][1] * pDecodeIn[1];
		output += std::sin(1 * pSpeakerAz) * weight2D[order - 1][2] * pDecodeIn[2];
		output += std::cos(2 * pSpeakerAz) * weight2D[order - 1][3] * pDecodeIn[3];
		output += std::sin(2 * pSpeakerAz) * weight2D[order - 1][4] * pDecodeIn[4];
		output += std::cos(3 * pSpeakerAz) * weight2D[order - 1][5] * pDecodeIn[5];
		output += std::sin(3 * pSpeakerAz) * weight2D[order - 1][6] * pDecodeIn[6];

		return output * norm2D[order - 1];
	}

private:
	double output;

inline static const std::array<double, 12> norm2D = {
		1.0,
		0.75,
		0.625,
		0.546875,
		0.492188,
		0.451172,
		0.418945,
		0.392761,
		0.370941,
		0.352394,
		0.336376,
		0.322360
	};

	inline static const std::array<std::array<double, 12>, 13> weight2D =
	{{
		{ 0.500000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 },
		{ 0.666667, 0.166667, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 },
		{ 0.750000, 0.300000, 0.050000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 },
		{ 0.750000, 0.300000, 0.050000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 },
		{ 0.800000, 0.400000, 0.114286, 0.014286, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 },
		{ 0.833333, 0.476190, 0.178571, 0.039683, 0.003968, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 },
		{ 0.857143, 0.535714, 0.238095, 0.071429, 0.012987, 0.001082, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 },
		{ 0.875000, 0.583333, 0.291667, 0.106060, 0.026515, 0.004079, 0.000291, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 },
		{ 0.888889, 0.622222, 0.339394, 0.141414, 0.043512, 0.009324, 0.001243, 0.000078, 0.000000, 0.000000, 0.000000, 0.000000 },
		{ 0.900000, 0.654545, 0.381818, 0.176224, 0.062937, 0.016783, 0.003147, 0.000370, 0.000021, 0.000000, 0.000000, 0.000000 },
		{ 0.909091, 0.681818, 0.419580, 0.209790, 0.083916, 0.026224, 0.006170, 0.001028, 0.000108, 0.000005, 0.000000, 0.000000 },
		{ 0.916667, 0.705128, 0.453297, 0.241758, 0.105769, 0.037330, 0.010370, 0.002183, 0.000327, 0.000031, 0.000001, 0.000000 },
		{ 0.923077, 0.725275, 0.483516, 0.271978, 0.127990, 0.049774, 0.015718, 0.003930, 0.000748, 0.000102, 0.000009, 0.000000 }
	}};

};
